<h1 class="flex items-center text-3xl font-extrabold dark:text-white mb-4 px-2">Settings</h1>
<div class="px-2">
  <div class="border-b border-gray-200 dark:border-gray-700">
    <%= render "shared/tabs/list",
        tabs: [
          { name: "Account Details", link: settings_account_url(current_account), active: false },
          { name: "Billing", link: overview_settings_billings_url(current_account), active: true },
          { name: "Members", link: settings_members_url(current_account), active: false },
        ]
    %>
  </div>
</div>

<section class="bg-gray-50 dark:bg-gray-900 py-3 sm:py-5">
  <div class="w-full bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700">
    <%= render "shared/tabs/billing_tabs", current_account: current_account, active: :overview %>

    <div>
      <div class="p-4 bg-white rounded-lg md:p-8 dark:bg-gray-800" id="about" role="tabpanel" aria-labelledby="about-tab">
      <!-- Current Plan Usage -->
      <div class="mb-8">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">Current Plan Usage</h3>
          <%= link_to "View Plans", plan_settings_billings_path(current_account), class: "text-sm font-medium text-primary-600 hover:underline dark:text-primary-500" %>
        </div>

        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <span class="text-gray-900 dark:text-white">Members</span>
              <span class="text-gray-900 dark:text-white">
                <% if @current_plan %>
                  <%= current_account.members.size %>
                  <span class="text-gray-500 dark:text-gray-400">of</span>
                  <%= @current_plan.member_limit %>
                <% else %>
                  <span class="text-gray-500 dark:text-gray-400">N/A</span>
                <% end %>
              </span>
            </div>

            <div class="flex justify-between items-center">
              <span class="text-gray-900 dark:text-white">Webhook Endpoints</span>
              <span class="text-gray-900 dark:text-white">
                <% if @current_plan %>
                  <%= current_account.webhook_endpoints.size %>
                  <span class="text-gray-500 dark:text-gray-400">of</span>
                  <%= @current_plan.webhook_endpoint_limit %>
                <% else %>
                  <span class="text-gray-500 dark:text-gray-400">N/A</span>
                <% end %>
              </span>
            </div>

            <div class="flex justify-between items-center">
              <span class="text-gray-900 dark:text-white">API Events</span>
              <span class="text-gray-900 dark:text-white">
                <% if @current_plan %>
                  <%= current_account.api_event_breakdown[:total] %>
                  <span class="text-gray-500 dark:text-gray-400">of</span>
                  <%= @current_plan.api_event_limit %>
                <% else %>
                  <span class="text-gray-500 dark:text-gray-400">N/A</span>
                <% end %>
              </span>
            </div>

            <% if @current_plan && current_account.api_event_breakdown[:total] > 0 %>
              <div class="flex items-center space-x-4 pt-2">
                <div class="flex items-center">
                  <div class="me-2 h-2 w-2 rounded-full bg-primary-700"></div>
                  <div class="text-sm text-gray-500 dark:text-gray-400">
                    <span class="font-medium text-gray-900 dark:text-white"><%= current_account.api_event_breakdown[:api_requests] %></span> API Requests
                  </div>
                </div>
                <div class="flex items-center">
                  <div class="me-2 h-2 w-2 rounded-full bg-primary-500"></div>
                  <div class="text-sm text-gray-500 dark:text-gray-400">
                    <span class="font-medium text-gray-900 dark:text-white"><%= current_account.api_event_breakdown[:webhook_events] %></span> Webhook Events
                  </div>
                </div>
              </div>
            <% end %>

            <% unless @current_plan %>
              <div class="pt-4 border-t border-gray-200 dark:border-gray-600">
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  You currently don't have an active plan.
                  <%= link_to "View our plans", plan_settings_billings_path(current_account), class: "font-medium text-primary-600 hover:underline dark:text-primary-500" %>
                  to get started.
                </p>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Billing Owner Information -->
      <div class="mb-8">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Billing Owner</h3>
        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-900 dark:text-white font-medium"><%= current_account.owner.display_name %></p>
              <p class="text-gray-500 dark:text-gray-400"><%= current_account.owner.email %></p>
            </div>
            <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-300">Owner</span>
          </div>
        </div>
      </div>

      <!-- Default Payment Method -->
      <div class="mb-8">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white">Default Payment Method</h3>
          <%= link_to "Manage Payment Methods", settings_payment_methods_path(current_account), class: "text-sm font-medium text-primary-600 hover:underline dark:text-primary-500" %>
        </div>
        <% if default_payment_method = current_account.payment_methods.find_by(default: true) %>
          <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <%= payment_method_icon(default_payment_method.brand) %>
                <div>
                  <p class="text-gray-900 dark:text-white font-medium">•••• •••• •••• <%= default_payment_method.last_four %></p>
                  <p class="text-gray-500 dark:text-gray-400">Expires <%= default_payment_method.exp_month %>/<%= default_payment_method.exp_year %></p>
                </div>
              </div>
              <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">Default</span>
            </div>
          </div>
        <% else %>
          <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
            <p class="text-gray-500 dark:text-gray-400">No payment method set</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</section>
