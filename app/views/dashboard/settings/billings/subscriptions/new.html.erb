<h1 class="flex items-center text-3xl font-extrabold dark:text-white mb-4 px-2">Settings</h1>

<div class="px-2">
  <div class="border-b border-gray-200 dark:border-gray-700">
    <%= render "shared/tabs/list",
      tabs: [
        { name: "Account Details", link: settings_account_path(current_account), active: false },
        { name: "Billing", link: overview_settings_billings_path(current_account), active: true },
        { name: "Members", link: settings_members_path(current_account), active: false },
      ]
    %>
  </div>
</div>

<section class="bg-gray-50 dark:bg-gray-900 py-3 sm:py-5">
  <div class="w-full bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700">
    <%= render "shared/tabs/billing_tabs", current_account: current_account, active: :plan %>

    <div class="p-6">
      <div class="max-w-2xl mx-auto">
        <h2 class="text-2xl font-bold mb-6 dark:text-white">Confirm Your Subscription</h2>

        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 mb-6">
          <h3 class="text-xl font-semibold mb-4 dark:text-white"><%= @plan.name %></h3>

          <div class="space-y-4">
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-300">Price</span>
              <span class="font-medium dark:text-white">
                <% @plan_periods.each.with_index do |period, index| %>
                  <div><%= period.price.format %> / <%= period.interval %></div>
                  <% if index < @plan_periods.size - 1 %>
                    <div class="text-gray-600 dark:text-gray-300 text-center">or</div>
                  <% end %>
                <% end %>
              </span>
            </div>

            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-300">Member Limit</span>
              <span class="font-medium dark:text-white"><%= @plan.member_limit %> members</span>
            </div>
          </div>
        </div>

        <%= form_with(
              model: @subscription,
              url: settings_subscriptions_path(current_account),
              method: :post,
              local: true,
              class: "space-y-6"
            ) do |f| %>
          <%= f.hidden_field :plan_id %>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">
              <%= @plan_periods.size == 1 ? "Chosen Billing Period" : "Select Billing Period" %>
            </label>
            <div class="space-y-2">
              <% @plan_periods.each do |period| %>
                <div class="flex items-center">
                  <%= f.radio_button :plan_period_id, period.id, class: "h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-gray-600", checked: @plan_period&.id == period.id %>
                  <%= f.label :plan_period_id, "#{period.price.format} / #{period.interval}", value: period.id, class: "ml-3 block text-sm font-medium text-gray-700 dark:text-gray-200" %>
                </div>
              <% end %>
            </div>
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">Payment Method</label>
            <div class="relative">
              <%= f.select :payment_method_id,
                  options_from_collection_for_select(@payment_methods, :id, :display_name),
                  {},
                  class: "mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" %>
            </div>
            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
              <%= link_to "Manage payment methods", settings_payment_methods_path(current_account), class: "text-primary-600 hover:text-primary-500" %>
            </p>
          </div>

          <% if @subscription.errors.any? %>
            <div class="bg-red-50 dark:bg-red-900 p-4 rounded-lg mb-6">
              <div class="font-medium text-red-800 dark:text-red-200">
                <%= pluralize(@subscription.errors.count, "error") %> prohibited this subscription from being saved:
              </div>
              <ul class="mt-3 list-disc list-inside text-sm text-red-700 dark:text-red-300">
                <% @subscription.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <div class="flex items-center space-x-4">
            <%= f.submit "Confirm Subscription", class: "px-5 py-2.5 text-sm font-medium text-white inline-flex items-center bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:outline-none focus:ring-primary-300 rounded-lg text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800" %>

            <%= link_to "Cancel", plan_settings_billings_path(current_account), class: "px-5 py-2.5 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</section>
